var I=Object.defineProperty,S=Object.defineProperties;var x=Object.getOwnPropertyDescriptors;var y=Object.getOwnPropertySymbols;var E=Object.prototype.hasOwnProperty,$=Object.prototype.propertyIsEnumerable;var F=(t,a,i)=>a in t?I(t,a,{enumerable:!0,configurable:!0,writable:!0,value:i}):t[a]=i,v=(t,a)=>{for(var i in a||(a={}))E.call(a,i)&&F(t,i,a[i]);if(y)for(var i of y(a))$.call(a,i)&&F(t,i,a[i]);return t},b=(t,a)=>S(t,x(a));import{u as C,j as s,a as o,r as D}from"./index.36570459.js";import{r as A,d as W,q as P,a as j}from"./constants.2243b20f.js";const k="_component_14028_1",q="_icon_14028_12",B="_name_14028_21",J="_weather_14028_28",O="_btn_14028_70",T="_addition_14028_86";var e={component:k,icon:q,name:B,weather:J,"temp-value":"_temp-value_14028_32","temp-time":"_temp-time_14028_46","weather-info":"_weather-info_14028_53","weather-tag-wrapper":"_weather-tag-wrapper_14028_57","weather-tag":"_weather-tag_14028_57",btn:O,addition:T,"addition-item":"_addition-item_14028_93","addition-label":"_addition-label_14028_120","addition-value":"_addition-value_14028_121"};function H(t){const a=C();function i(){const l=new Date,c=l.getHours();return`${W[l.getDay()]}, ${c>12?c-12:c}${c>12?"pm":"am"}`}function _(l,c){a(`./detail/${window.btoa(`${l},${c}`)}`)}const{name:f,icon:n,temp:d,text:r,windDir:m,windScale:h,precip:u,humidity:g,windSpeed:N,longitude:w,latitude:p}=t.data;return s("div",{className:e.component,children:[n?o("img",{className:e.icon,src:A(n)}):null,o("p",{className:e.name,children:f}),s("section",{className:e.weather,children:[s("div",{className:e["weather-temp"],children:[o("p",{className:e["temp-value"],children:d}),o("p",{className:e["temp-time"],children:i()})]}),s("div",{className:e["weather-info"],children:[o("p",{className:e["weather-tag-wrapper"],children:s("span",{className:e["weather-tag"],children:[m,h,"\u7EA7"]})}),o("p",{className:e["weather-tag-wrapper"],children:o("span",{className:e["weather-tag"],style:{background:"rgba(106, 117, 186, 0.5)"},children:r})})]})]}),o("button",{disabled:!p||!w,className:e.btn,onClick:_.bind(null,w,p),children:"\u8BE6\u60C5"}),s("aside",{className:e.addition,children:[s("dl",{className:e["addition-item"],children:[o("dt",{className:e["addition-label"],children:"\u964D\u6C34\u91CF"}),s("dd",{className:e["addition-value"],children:[u,"mm"]})]}),s("dl",{className:e["addition-item"],children:[o("dt",{className:e["addition-label"],children:"\u6E7F\u5EA6"}),s("dd",{className:e["addition-value"],children:[g,"%"]})]}),s("dl",{className:e["addition-item"],children:[o("dt",{className:e["addition-label"],children:"\u98CE\u901F"}),s("dd",{className:e["addition-value"],children:[N,"km/h"]})]})]})]})}function z(){const[t,a]=D.exports.useState({name:"--",icon:"",temp:"--",obsTime:"--",text:"--",windDir:"--",windScale:"--",windSpeed:"--",precip:"--",humidity:"--"});function i(){try{a(JSON.parse(window.localStorage.getItem("weatherInfo")||"{}"))}catch{console.log("weather info init error")}}async function _(n,d){const{location:r=[]}=await P(n,d);if(r.length){const{adm1:m,adm2:h,name:u}=r[0];a(b(v({},t),{name:`${u}, ${m}`}))}}async function f(n,d){const{now:{temp:r,obsTime:m,text:h,icon:u,windDir:g,windScale:N,windSpeed:w,precip:p,humidity:l}}=await j(n,d),c=b(v({},t),{temp:r,obsTime:m,text:h,icon:u,windDir:g,windScale:N,windSpeed:w,precip:p,humidity:l,longitude:n,latitude:d});a(c),window.localStorage.setItem("weatherInfo",JSON.stringify(c))}return D.exports.useEffect(()=>{i(),navigator.geolocation.getCurrentPosition(async n=>{const{longitude:d,latitude:r}=n&&n.coords||{};d&&r&&(t.name==="--"?_(d,r):f(d,r))},n=>{console.error(n);const d=window.localStorage.getItem("weatherInfo");if(t.name==="--"&&d)try{a(JSON.parse(d))}catch(r){console.log(r),window.alert(`\u83B7\u53D6\u4F4D\u7F6E\u4FE1\u606F\u5931\u8D25\uFF1A${n.message}`)}else window.alert(`\u83B7\u53D6\u4F4D\u7F6E\u4FE1\u606F\u5931\u8D25\uFF1A${n.message}`)},{maximumAge:6e4})},[t.name]),s("div",{className:"view__home",children:[o("header",{className:"header"}),o("main",{className:"main",children:o(H,{data:t})})]})}export{z as default};
